name: Stale PR Management

on:
  schedule:
    # Runs every day at 06:00 UTC
    - cron: '0 6 * * *'
  workflow_dispatch:

permissions:
  pull-requests: write
  issues: write

jobs:
  stale-prs:
    runs-on: ubuntu-latest
    steps:
      - name: Mark and close stale pull requests
        uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}

          # PR lifecycle policy
          days-before-pr-stale: 7
          days-before-pr-close: 3
          stale-pr-label: stale

          # Keep critical/blocking items open
          exempt-pr-labels: blocked,priority-high,security

          # Only target pull requests (not issues)
          days-before-issue-stale: -1
          days-before-issue-close: -1

          stale-pr-message: |
            هذا الـ PR أصبح غير نشط لمدة 7 أيام.

            **الخطوة التالية خلال 3 أيام:**
            - ادفع تحديث (commit) أو
            - علّق بسبب التأخير وخطة الإكمال.

            إذا كان هذا PR معتمدًا على عنصر آخر، أضف label `blocked` حتى لا يُغلق تلقائيًا.

          close-pr-message: |
            تم إغلاق هذا الـ PR تلقائيًا بسبب عدم النشاط.

            يمكن إعادة فتحه بأي وقت بعد إضافة تحديث واضح أو ربطه بخطة تنفيذ.

          ascending: true
          remove-stale-when-updated: true
          operations-per-run: 100
